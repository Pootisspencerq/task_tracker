<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Task Tracker{% endblock %}</title>

    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'meme_theme/style.css' %}">

    <style>
        /* ===== LIGHT ===== */
        body.theme-light {
            background-color: #ffffff !important;
            color: #000000 !important;
        }
        body.theme-light .navbar,
        body.theme-light .card,
        body.theme-light .dropdown-menu,
        body.theme-light .form-control {
            background-color: #ffffff !important;
            color: #000 !important;
            border: 1px solid #ddd !important;
        }
        body.theme-light .btn {
            background-color: #f8f9fa !important;
            color: #000 !important;
            border: 1px solid #ccc !important;
        }

        /* ===== DARK ===== */
        body.theme-dark {
            background-color: #121212 !important;
            color: #e0e0e0 !important;
        }
        body.theme-dark .navbar,
        body.theme-dark .card,
        body.theme-dark .dropdown-menu,
        body.theme-dark .form-control {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
            border: 1px solid #333 !important;
        }
        body.theme-dark .btn {
            background-color: #333 !important;
            color: #fff !important;
            border: 1px solid #555 !important;
        }
        body.theme-dark .btn:hover { 
            background-color: #444 !important; 
            color: #fff !important;
        }
        body.theme-dark h1, body.theme-dark h2, body.theme-dark h3,
        body.theme-dark h4, body.theme-dark h5, body.theme-dark h6,
        body.theme-dark p, body.theme-dark li, body.theme-dark a, 
        body.theme-dark label, body.theme-dark span {
            color: #e0e0e0 !important;
        }
        body.theme-dark input[type="text"], 
        body.theme-dark textarea {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
            border: 1px solid #555 !important;
        }

        /* ===== MEME ===== */
        body.theme-meme {
            background-image: url("{% static 'meme_theme/meme_bg.jpg' %}");
            background-size: cover;
            background-attachment: fixed;
            color: lime !important;
            font-family: "Comic Sans MS", cursive, sans-serif;
            text-shadow: 1px 1px 2px #000;
        }
        body.theme-meme .navbar,
        body.theme-meme .card,
        body.theme-meme .dropdown-menu,
        body.theme-meme .form-control {
            background-color: rgba(0,0,0,0.7) !important;
            color: lime !important;
            border: 2px dashed magenta !important;
        }
        body.theme-meme .btn {
            background-color: magenta !important;
            color: yellow !important;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid black !important;
        }
        body.theme-meme .btn:hover {
            background-color: lime !important;
            color: black !important;
        }
        body.theme-meme h1, body.theme-meme h2, body.theme-meme h3,
        body.theme-meme h4, body.theme-meme h5, body.theme-meme h6,
        body.theme-meme p, body.theme-meme li, body.theme-meme a, 
        body.theme-meme label, body.theme-meme span {
            color: lime !important;
        }
        body.theme-meme input[type="text"], 
        body.theme-meme textarea {
            background-color: yellow !important;
            color: black !important;
            border: 2px solid black !important;
        }

        /* KONAMI OVERLAY */
        #konamiOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 2000;
        }
        #konamiOverlay img { max-width: 200px; margin-bottom: 20px; }
        #konamiOverlay iframe { width: 80%; height: 60%; border: none; }
    </style>
</head>
<body class="theme-light">

    <!-- –ù–∞–≤–±–∞—Ä -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="{% url 'tasks:task-list' %}">
                <img src="{% static 'img/logo.png' %}" alt="Logo" height="40" class="me-2">
                Task Tracker
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'tasks:task-list' %}">üè† –ì–æ–ª–æ–≤–Ω–∞</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'tasks:editor' %}">üìù –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'tasks:workshop' %}">üìí –í–æ—Ä–∫—à–æ–ø</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'tasks:note-create' %}">üóíÔ∏è –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º—ñ—Ç–∫—É</a>
                    </li>

                    <!-- –¢–µ–º–∞ -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="themeToggleBtn">
                            üé® –¢–µ–º–∞
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" id="themeMenu">
                            <li><a class="dropdown-item" href="#" data-theme="theme-light">üåû –°–≤—ñ—Ç–ª–∞</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="theme-dark">üåë –¢–µ–º–Ω–∞</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="theme-meme">üòÇ –ú–µ–º–Ω–∞</a></li>
                        </ul>
                    </li>

                    <!-- Logout -->
                    <li class="nav-item">
                        <form action="{% url 'logout' %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="nav-link btn btn-link p-0 m-0" style="text-decoration:none;">
                                üö™ –í–∏–π—Ç–∏
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container mt-4">
        {% block content %}{% endblock %}
    </div>

    <!-- KONAMI OVERLAY -->
    <div id="konamiOverlay" role="dialog" aria-modal="true" aria-hidden="true">
        <img id="konamiMegaImage" src="{% static 'meme_theme/cool-pic.png' %}" alt="COA VIDAS Sequence">
        <iframe id="konamiVideo" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <button class="btn btn-danger mt-3" onclick="hideKonami()" aria-label="–ó–∞–∫—Ä–∏—Ç–∏ –≤—ñ–¥–µ–æ">‚úñÔ∏è –ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>

    <script>
        const THEMES = ['theme-light', 'theme-dark', 'theme-meme'];
        let currentTheme = localStorage.getItem('theme') || 'theme-light';

        function applyTheme(theme) {
            THEMES.forEach(t => document.body.classList.remove(t));
            document.body.classList.add(theme);
            localStorage.setItem('theme', theme);

            const logoImg = document.querySelector('.navbar-brand img');
            const themeToggleBtn = document.getElementById('themeToggleBtn');

            if (theme === 'theme-meme') {
                if (!document.getElementById('meme-audio')) {
                    const audio = document.createElement('audio');
                    audio.id = 'meme-audio';
                    audio.src = '{% static "meme_theme/hamster_dance.mp3" %}';
                    audio.loop = true;
                    audio.autoplay = true;
                    audio.volume = 0.2;
                    document.body.appendChild(audio);
                }
                if (logoImg) logoImg.src = '{% static "meme_theme/shrek.png" %}';
                themeToggleBtn.innerText = "üòÇ –ú–µ–º–Ω–∞";
            } else {
                const oldAudio = document.getElementById('meme-audio');
                if (oldAudio) oldAudio.remove();
                if (logoImg) logoImg.src = '{% static "img/logo.png" %}';
                themeToggleBtn.innerText = (theme === 'theme-light') ? "üåû –°–≤—ñ—Ç–ª–∞" : "üåë –¢–µ–º–Ω–∞";
            }
        }

        document.querySelectorAll('#themeMenu a').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const theme = item.getAttribute('data-theme');
                currentTheme = theme;
                applyTheme(theme);
            });
        });

        window.onload = () => { applyTheme(currentTheme); };

        // KONAMI
        const overlay = document.getElementById('konamiOverlay');
        const iframe = document.getElementById('konamiVideo');
        const konamiCode = [
            'ArrowUp','ArrowUp','ArrowDown','ArrowDown',
            'ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','KeyB','KeyA'
        ];
        let buffer = [];

        function showKonami() {
            overlay.style.display = 'flex';
            overlay.setAttribute('aria-hidden', 'false');
            iframe.src = "https://www.youtube.com/embed/RV0VJNvcBFU?autoplay=1&controls=1&loop=1&playlist=RV0VJNvcBFU";
        }
        function hideKonami() {
            overlay.style.display = 'none';
            overlay.setAttribute('aria-hidden', 'true');
            iframe.src = "";
        }
        document.addEventListener('keydown', (e) => {
            buffer.push(e.code);
            if (buffer.length > konamiCode.length) buffer.shift();
            if (JSON.stringify(buffer) === JSON.stringify(konamiCode)) {
                showKonami();
                buffer = [];
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
