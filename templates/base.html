{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Task Tracker{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  <style>
    body.light-mode {
      background-color: #ffffff;
      color: #000000;
    }

    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }

    body.meme-mode {
      background-image: url("{% static 'img/meme_bg.jpg' %}");
      background-size: cover;
      background-position: center;
      color: #00ff00;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }

    /* –ü–æ–∫–∞–∑ –ª–æ–≥–æ—Ç–∏–ø–∞ –®—Ä–µ–∫–∞ –≤ –º–µ–º–Ω—ñ–π —Ç–µ–º—ñ */
    .simple-logo {
      display: inline-block;
    }

    body.meme-mode .simple-logo {
      display: none;
    }

    body.meme-mode .navbar-brand::before {
      content: '';
      display: inline-block;
      width: 32px;
      height: 32px;
      margin-right: 10px;
      background-image: url("{% static 'img/shrek_logo.png' %}");
      background-size: contain;
      background-repeat: no-repeat;
    }

    /* Konami overlay styles */
    #konamiOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #konamiOverlay iframe {
      width: 90%;
      max-width: 560px;
      height: 315px;
      border-radius: 15px;
      box-shadow: 0 0 30px red;
    }

    #konamiOverlay button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
    }

    #konamiOverlay button:hover {
      background-color: #1c7a34;
    }
  </style>
</head>
<body>
  {% include 'menu.html' %}

  <div class="container mt-4">
    {% block content %}{% endblock %}
  </div>

  <!-- Theme dropdown -->
  <div class="dropdown position-fixed bottom-0 end-0 m-3">
    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
      üåì –¢–µ–º–∞
    </button>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item" href="#" onclick="setTheme('light')">‚òÄÔ∏è –°–≤—ñ—Ç–ª–∞</a></li>
      <li><a class="dropdown-item" href="#" onclick="setTheme('dark')">üåô –¢–µ–º–Ω–∞</a></li>
      <li><a class="dropdown-item" href="#" onclick="setTheme('meme')">üòÇ –ú–µ–º–Ω–∞</a></li>
    </ul>
  </div>

  <!-- Konami Code Overlay -->
  <div id="konamiOverlay">
    <div class="text-center">
      <iframe id="konamiVideo" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      <br>
      <button onclick="hideKonami()">‚úñ –ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function setTheme(theme) {
      document.body.classList.remove('light-mode', 'dark-mode', 'meme-mode');
      document.body.classList.add(`${theme}-mode`);
      localStorage.setItem('theme', theme);
    }

    window.onload = () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      setTheme(savedTheme);
    };

    const overlay = document.getElementById('konamiOverlay');
    const iframe = document.getElementById('konamiVideo');
    const konamiCode = [
      'ArrowUp', 'ArrowUp',
      'ArrowDown', 'ArrowDown',
      'ArrowLeft', 'ArrowRight',
      'ArrowLeft', 'ArrowRight',
      'KeyB', 'KeyA'
    ];
    let buffer = [];

    document.addEventListener('keydown', (e) => {
      buffer.push(e.code);
      if (buffer.length > konamiCode.length) buffer.shift();
      if (JSON.stringify(buffer) === JSON.stringify(konamiCode)) {
        overlay.style.display = 'flex';
        iframe.src = "https://www.youtube.com/embed/RV0VJNvcBFU?autoplay=1&controls=1&loop=1&playlist=RV0VJNvcBFU";
        buffer = [];
      }
    });

    function hideKonami() {
      overlay.style.display = 'none';
      iframe.src = "";
    }
  </script>
</body>
</html>
