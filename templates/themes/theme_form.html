{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Створення нової теми{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Створення нової теми</h1>

  <form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="mb-4">
      <label for="{{ form.workshop.id_for_label }}" class="form-label fw-bold">Виберіть Майстерню</label>
      {{ form.workshop|add_class:"form-select" }}
      {{ form.workshop.errors }}
    </div>

    <div class="mb-4">
      <label for="{{ form.name.id_for_label }}" class="form-label fw-bold">Назва Теми</label>
      {{ form.name|add_class:"form-control form-control-lg" }}
      {{ form.name.errors }}
    </div>

    <div class="mb-4">
      <label for="{{ form.description.id_for_label }}" class="form-label fw-bold">Опис Теми</label>
      {{ form.description|add_class:"form-control" }}
      {{ form.description.errors }}
    </div>

    <div class="mb-4">
      <label for="{{ form.primary_color.id_for_label }}" class="form-label fw-bold">Основний колір</label>
      {{ form.primary_color|add_class:"form-control form-control-color" }}
      {{ form.primary_color.errors }}
    </div>

    <div class="mb-4">
      <label for="{{ form.secondary_color.id_for_label }}" class="form-label fw-bold">Допоміжний колір</label>
      {{ form.secondary_color|add_class:"form-control form-control-color" }}
      {{ form.secondary_color.errors }}
    </div>

    <div class="mb-4">
      <label for="{{ form.font_family.id_for_label }}" class="form-label fw-bold">Шрифт</label>
      {{ form.font_family|add_class:"form-select" }}
      {{ form.font_family.errors }}
    </div>

    <div class="mb-4">
      <label for="{{ form.background_image.id_for_label }}" class="form-label fw-bold">Фонове зображення</label>
      {{ form.background_image|add_class:"form-control" }}
      {{ form.background_image.errors }}
    </div>

    <button type="submit" class="btn btn-success btn-lg">Створити тему</button>
  </form>

  <h3 class="mt-5 mb-3">Попередній перегляд</h3>
  <div id="previewBox" style="width: 100%; max-width: 600px; height: 200px; border: 1px solid #ccc; padding: 20px; background-size: cover; background-position: center;">
    Це попередній перегляд теми
  </div>
</div>

<script>
  const previewBox = document.getElementById('previewBox');

  const primaryColorInput = document.getElementById('{{ form.primary_color.id_for_label }}');
  const secondaryColorInput = document.getElementById('{{ form.secondary_color.id_for_label }}');
  const fontFamilySelect = document.getElementById('{{ form.font_family.id_for_label }}');
  const backgroundImageInput = document.getElementById('{{ form.background_image.id_for_label }}');

  function updatePreview() {
    previewBox.style.color = primaryColorInput.value;
    previewBox.style.backgroundColor = secondaryColorInput.value;
    previewBox.style.fontFamily = fontFamilySelect.value;
  }

  primaryColorInput.addEventListener('input', updatePreview);
  secondaryColorInput.addEventListener('input', updatePreview);
  fontFamilySelect.addEventListener('change', updatePreview);

  backgroundImageInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        previewBox.style.backgroundImage = `url(${e.target.result})`;
      };
      reader.readAsDataURL(file);
    } else {
      previewBox.style.backgroundImage = '';
    }
  });

  // Initialize preview with default values on page load
  updatePreview();
</script>
{% endblock %}
